

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fancy Argument Parsing &mdash; c-extension-tutorial  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="c-extension-tutorial  documentation" href="index.html"/>
        <link rel="next" title="Writing a New Class in C" href="writing-a-class.html"/>
        <link rel="prev" title="Abstract Object API" href="abstract-api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> c-extension-tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="what-is-an-extension-module.html">What is an Extension Module?</a></li>
<li class="toctree-l1"><a class="reference internal" href="c-level-representation.html">C Level Representation of Python Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-a-function.html">Writing a New Function in C</a></li>
<li class="toctree-l1"><a class="reference internal" href="building-and-importing.html">Building and Importing</a></li>
<li class="toctree-l1"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="abstract-api.html">Abstract Object API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fancy Argument Parsing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#type-conversion">Type Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#naming-our-function">Naming our Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optional-arguments">Optional Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keyword-only-arguments">Keyword Only Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-optional-arguments-a-and-b-to-fib">Add Optional Arguments <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> to <code class="docutils literal"><span class="pre">fib</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing-a-class.html">Writing a New Class in C</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-issues.html">Common Issues and Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdb.html">Debugging with GDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="member-vs-getset.html"><code class="docutils literal"><span class="pre">PyMemberDef</span></code> vs <code class="docutils literal"><span class="pre">PyGetSetDef</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">c-extension-tutorial</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Fancy Argument Parsing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/fancy-argument-parsing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fancy-argument-parsing">
<h1>Fancy Argument Parsing<a class="headerlink" href="#fancy-argument-parsing" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="appendix.html#c.METH_O" title="METH_O"><code class="xref c c-macro docutils literal"><span class="pre">METH_O</span></code></a> is convenient for quickly testing a function, but Python
programmers are used to more expressive argument passing. Python functions can
accept multiple arguments, have default value, or accept arguments by
keyword.</p>
<p>As a first pass, we could replace the <a class="reference internal" href="appendix.html#c.METH_O" title="METH_O"><code class="xref c c-macro docutils literal"><span class="pre">METH_O</span></code></a> in our
<a class="reference internal" href="appendix.html#c.PyMethodDef" title="PyMethodDef"><code class="xref c c-type docutils literal"><span class="pre">PyMethodDef</span></code></a> structure with <a class="reference internal" href="appendix.html#c.METH_VARARGS" title="METH_VARARGS"><code class="xref c c-macro docutils literal"><span class="pre">METH_VARARGS</span></code></a> |
<a class="reference internal" href="appendix.html#c.METH_KEYWORDS" title="METH_KEYWORDS"><code class="xref c c-macro docutils literal"><span class="pre">METH_KEYWORDS</span></code></a>. This tell CPython to pass us three arguments:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a> <code class="docutils literal"><span class="pre">self</span></code>: The module or instance.</li>
<li><a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a> <code class="docutils literal"><span class="pre">args</span></code>: A tuple of positional arguments.</li>
<li><a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a> <code class="docutils literal"><span class="pre">kwargs</span></code>: A dictionary of keyword arguments or
<code class="xref c c-data docutils literal"><span class="pre">NULL</span></code> if no keyword arguments are provided. The dict can also be
empty.</li>
</ol>
<p>This is like defining a Python function like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>We now have full control over how we parse arguments, however, this would make
it very tedious to implement common patterns. CPython has a helper function
called <a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> which can take our <code class="docutils literal"><span class="pre">args</span></code>,
<code class="docutils literal"><span class="pre">kwargs</span></code>, argument names, and some signature, and parse out the values.</p>
<p>To define the signature of our function we use a format string sort of like the
C standard library function <code class="docutils literal"><span class="pre">sscanf</span></code>. This string needs to encode the type of
all of our arguments and how to convert them to C values.</p>
<p>The simplest type we can express is <code class="docutils literal"><span class="pre">O</span></code>, which accepts any Python object and
gives it to the function as a <a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a> with no conversion applied. We
can rewrite our <code class="docutils literal"><span class="pre">pyfib</span></code> parsing using just this single conversion like:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="n">PyObject</span><span class="o">*</span>
<span class="nf">pyfib</span><span class="p">(</span><span class="n">PyObject</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">kwargs</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* the names of the arguments as a static array */</span>
    <span class="k">static</span> <span class="kt">char</span><span class="o">*</span> <span class="n">keywords</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>

    <span class="n">PyObject</span><span class="o">*</span> <span class="n">n</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;O&quot;</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">))</span> <span class="p">{</span>
        <span class="cm">/* the arguments passed don&#39;t correspond to the signature</span>
<span class="cm">           described */</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We start by changing the signature to accept <code class="docutils literal"><span class="pre">args</span></code> and <code class="docutils literal"><span class="pre">kwargs</span></code> instead of
just <code class="docutils literal"><span class="pre">n</span></code>. Next, we need to define the names of the parameter as we will call
them from Python. We store this information in a <code class="docutils literal"><span class="pre">static</span> <span class="pre">char*[]</span></code> so we don&#8217;t
need to re-initialize it each time the function is called. Next, we call
<a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> with our <code class="docutils literal"><span class="pre">args</span></code>, <code class="docutils literal"><span class="pre">kwargs</span></code>. We give it
a format string of <code class="docutils literal"><span class="pre">&quot;O&quot;</span></code> which means our function accepts exactly one object
of any kind given to us as a <a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a>. After the format string we
pass the names of the arguments which is the array <code class="docutils literal"><span class="pre">{&quot;n&quot;,</span> <span class="pre">NULL}</span></code>. The number
of entries in this array should match up with the number of arguments specified
in the format string. After the argument names is the address of our local
variable <code class="docutils literal"><span class="pre">n</span></code>. If argument parsing succeeds, <code class="docutils literal"><span class="pre">n</span></code> will now be a <a class="reference internal" href="appendix.html#borrowed-reference"><span class="std std-ref">borrowed
reference</span></a> to the single argument.</p>
<p>We also need to update our <a class="reference internal" href="appendix.html#c.PyMethodDef" title="PyMethodDef"><code class="xref c c-type docutils literal"><span class="pre">PyMethodDef</span></code></a> to look like:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">PyMethodDef</span> <span class="n">methods</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;fib&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span> <span class="n">pyfib</span><span class="p">,</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span> <span class="n">fib_doc</span><span class="p">},</span>
    <span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This looks like a lot more work than just using <a class="reference internal" href="appendix.html#c.METH_O" title="METH_O"><code class="xref c c-macro docutils literal"><span class="pre">METH_O</span></code></a>, but now we
can call <code class="docutils literal"><span class="pre">fib</span></code> from Python as <code class="docutils literal"><span class="pre">fib(n=n)</span></code> instead of just passing <code class="docutils literal"><span class="pre">n</span></code>
positionally.</p>
<div class="section" id="type-conversion">
<h2>Type Conversion<a class="headerlink" href="#type-conversion" title="Permalink to this headline">¶</a></h2>
<p>One nice feature of <a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> is that it can convert
<a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a>s into C types for us. This helps us generate better and
more standardized error messages when users provide values of unexpected types.</p>
<p>For example, we can write a simple integer add function using
<a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> by using the <code class="docutils literal"><span class="pre">i</span></code> format character. This
format character looks for a Python <code class="xref c c-type docutils literal"><span class="pre">int</span></code> object as an input and will
convert to a C <code class="xref c c-type docutils literal"><span class="pre">int</span></code> for us. Instead of passing the address of a
<a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-func docutils literal"><span class="pre">PyObject*()</span></code></a> to hold the result, we pass the address of a C
<code class="xref c c-type docutils literal"><span class="pre">int</span></code>. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="n">PyObject</span><span class="o">*</span>
<span class="nf">add</span><span class="p">(</span><span class="n">PyObject</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">char</span><span class="o">*</span> <span class="n">keywords</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>

    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span>
                                     <span class="n">kwargs</span><span class="p">,</span>
                                     <span class="s">&quot;ii&quot;</span><span class="p">,</span>
                                     <span class="n">keywords</span><span class="p">,</span>
                                     <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span>
                                     <span class="o">&amp;</span><span class="n">b</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a silly example because we would normally just use <code class="docutils literal"><span class="pre">+</span></code> in Python, but
we can use it to see the error messages we get:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># call with correct positional arguments</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># ``a`` as a float</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mo">06</span><span class="n">d2968d6f5e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">add</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">integer</span> <span class="n">argument</span> <span class="n">expected</span><span class="p">,</span> <span class="n">got</span> <span class="nb">float</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># call with correct keyword arguments</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">f6721327c99d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">function</span> <span class="n">takes</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">3</span> <span class="n">given</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># unknown keyword argument</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">c9aad4a5afdb</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">function</span> <span class="n">takes</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">3</span> <span class="n">given</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># duplicate argument (positional and keyword)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">a765fb2e71a3</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">function</span> <span class="n">takes</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">3</span> <span class="n">given</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># call with mix of positional and keyword arguments</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="naming-our-function">
<h2>Naming our Function<a class="headerlink" href="#naming-our-function" title="Permalink to this headline">¶</a></h2>
<p>The default error messages are descriptive but are missing the name of our
function. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="n">function</span> <span class="n">takes</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">3</span> <span class="n">given</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be confusing to readers later. <a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a>
can be told the name of the function in the format string by suffixing the type
signature with <code class="docutils literal"><span class="pre">:name</span></code>. In our <code class="docutils literal"><span class="pre">add</span></code> function we can change the format
string from <code class="docutils literal"><span class="pre">&quot;ii&quot;</span></code> to <code class="docutils literal"><span class="pre">&quot;ii:add&quot;</span></code>. Now, if we pass too many arguments we will
see:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="n">add</span><span class="p">()</span> <span class="n">takes</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">3</span> <span class="n">given</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-arguments">
<h2>Optional Arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this headline">¶</a></h2>
<p>Another feature of Python is support for optional or default
arguments. <a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> also supports optional
arguments with the <code class="docutils literal"><span class="pre">|</span></code> special character. Any parameter types that follow a
pipe will be considered optional. If the argument is not provided, the value of
the reference will remain unchanged. For example, we could add a default value
of <code class="docutils literal"><span class="pre">b=1</span></code> in our <code class="docutils literal"><span class="pre">add</span></code> function:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="n">PyObject</span><span class="o">*</span>
<span class="nf">add</span><span class="p">(</span><span class="n">PyObject</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span><span class="o">*</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">char</span><span class="o">*</span> <span class="n">keywords</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>

    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span>
                                     <span class="n">kwargs</span><span class="p">,</span>
                                     <span class="s">&quot;i|i&quot;</span><span class="p">,</span>
                                     <span class="n">keywords</span><span class="p">,</span>
                                     <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span>
                                     <span class="o">&amp;</span><span class="n">b</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When <code class="docutils literal"><span class="pre">b</span></code> is not provided either positionally or by keyword, the value of
<code class="docutils literal"><span class="pre">&amp;b</span></code> will remain unchanged after <a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> so it
will have a default value of 1.</p>
<p>We can still explicitly pass <code class="docutils literal"><span class="pre">b</span></code> to change this: for example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="keyword-only-arguments">
<h2>Keyword Only Arguments<a class="headerlink" href="#keyword-only-arguments" title="Permalink to this headline">¶</a></h2>
<p>Python 3 added support for keyword only arguments. These are arguments which
<em>cannot</em> be passed positionally. These are useful for boolean arguments, or
uncommon flags because it enforces the caller must be descriptive at the call
site.</p>
<p><a class="reference internal" href="appendix.html#c.PyArg_ParseTupleAndKeywords" title="PyArg_ParseTupleAndKeywords"><code class="xref c c-func docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords()</span></code></a> supports keyword only arguments with the
<code class="docutils literal"><span class="pre">$</span></code> special character. Any parameter types following a dollar sign can only be
passed by keyword. For example, if we hated our users, we could require <code class="docutils literal"><span class="pre">b</span></code> be
passed by keyword by changing our format string to: <code class="docutils literal"><span class="pre">i$i</span></code>. Keyword only
arguments may also be optional, this is done by putting the the <code class="docutils literal"><span class="pre">$</span></code> after a
<code class="docutils literal"><span class="pre">|</span></code>, for example: <code class="docutils literal"><span class="pre">i|$i</span></code>.</p>
</div>
<div class="section" id="add-optional-arguments-a-and-b-to-fib">
<h2>Add Optional Arguments <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> to <code class="docutils literal"><span class="pre">fib</span></code><a class="headerlink" href="#add-optional-arguments-a-and-b-to-fib" title="Permalink to this headline">¶</a></h2>
<p>As an exercise, try adding two new arguments to <code class="docutils literal"><span class="pre">fib</span></code>: <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code>. These
arguments should both default to 1 and are the seed values for the Fibonacci
sequence.</p>
<p>You may either accept the arguments as <a class="reference internal" href="appendix.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal"><span class="pre">PyObject*</span></code></a> and use the
<a class="reference internal" href="appendix.html#number-api"><span class="std std-ref">Abstract Number API</span></a> or accept them as C types and use normal
C arithmetic.</p>
<p>If you finish early, try to implement it using the other technique.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="writing-a-class.html" class="btn btn-neutral float-right" title="Writing a New Class in C" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="abstract-api.html" class="btn btn-neutral" title="Abstract Object API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Joe Jevnik.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>